---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: potatostack

bases:
  - ../../base

patchesStrategicMerge:
  - resource-limits.yaml
  - storage-class.yaml

replicas:
  - name: gitea
    count: 1
  - name: immich-server
    count: 1
  - name: grafana
    count: 1

images:
  # Production pinned versions for stability
  - name: tensorchord/pgvecto-rs
    newTag: pg14-v0.2.0
  - name: redis
    newTag: 7.2-alpine
  - name: gitea/gitea
    newTag: 1.21.5
  - name: ghcr.io/immich-app/immich-server
    newTag: v1.95.1
  - name: vaultwarden/server
    newTag: 1.30.3-alpine
  - name: qmcgaw/gluetun
    newTag: v3.37.0
  - name: grafana/grafana
    newTag: 10.3.3
  - name: grafana/loki
    newTag: 2.9.5

configMapGenerator:
  - name: production-config
    literals:
      - ENVIRONMENT=production
      - ENABLE_TELEMETRY=false
