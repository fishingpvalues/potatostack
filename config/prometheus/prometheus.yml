global:
  scrape_interval: 30s
  evaluation_interval: 30s
  external_labels:
    cluster: "potatostack-main"
    environment: "production"
    replica: "primary"

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

# Load alert rules
rule_files:
  - "/etc/prometheus/alerts/*.yml"

# Scrape configurations - ALL services with metrics
scrape_configs:
  # Prometheus self-monitoring
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # CrowdSec IPS metrics
  - job_name: "crowdsec"
    static_configs:
      - targets: ["crowdsec:6060"]
    metrics_path: "/metrics"

  # Miniflux RSS reader metrics
  - job_name: "miniflux"
    static_configs:
      - targets: ["miniflux:8080"]
    metrics_path: "/metrics"

  # Netdata - DISABLED: Use node-exporter instead
  # - job_name: "netdata"
  #   static_configs:
  #     - targets: ["netdata:19999"]
  #   metrics_path: "/api/v1/allmetrics"
  #   params:
  #     format: ["prometheus"]
  #   honor_labels: true

  # Alertmanager
  - job_name: "alertmanager"
    static_configs:
      - targets: ["alertmanager:9093"]

  # ntfy metrics
  - job_name: "ntfy"
    static_configs:
      - targets: ["ntfy:80"]
    metrics_path: "/metrics"

  # Loki log aggregation
  - job_name: "loki"
    static_configs:
      - targets: ["loki:3100"]
    metrics_path: "/metrics"

  # slskd metrics
  - job_name: "slskd"
    static_configs:
      - targets: ["gluetun:2234"]
    metrics_path: "/metrics"

  # Grafana
  - job_name: "grafana"
    static_configs:
      - targets: ["grafana:3000"]
    metrics_path: "/metrics"

  # PostgreSQL via postgres_exporter
  - job_name: "postgres-exporter"
    static_configs:
      - targets: ["postgres-exporter:9187"]

  # Redis via redis_exporter
  - job_name: "redis-exporter"
    static_configs:
      - targets: ["redis-exporter:9121"]

  # MongoDB via mongodb_exporter
  - job_name: "mongodb-exporter"
    static_configs:
      - targets: ["mongodb-exporter:9216"]

  # Node Exporter for host metrics
  - job_name: "node-exporter"
    static_configs:
      - targets: ["node-exporter:9100"]

  # SMART disk health via smartctl-exporter
  - job_name: "smartctl-exporter"
    static_configs:
      - targets: ["smartctl-exporter:9633"]

  # Bitmagnet DHT crawler metrics
  - job_name: "bitmagnet"
    static_configs:
      - targets: ["gluetun:3333"]
    metrics_path: "/metrics"

  # Freqtrade - Algorithmic trading bot API metrics
  - job_name: "freqtrade"
    static_configs:
      - targets: ["freqtrade-bot:8080"]
    metrics_path: "/api/v1/health"
    scrape_interval: 60s

  # Ghostfolio - Portfolio tracker health
  - job_name: "ghostfolio"
    static_configs:
      - targets: ["ghostfolio:3333"]
    metrics_path: "/api/v1/health"
    scrape_interval: 60s
