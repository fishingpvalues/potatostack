################################################################################
# PotatoStack Main Environment Configuration
# Target: Mini PC with 16GB RAM, 4+ core CPU, 1GB ethernet
# Copy this file to .env and fill in your actual values
# NEVER commit the .env file to git - it contains sensitive passwords!
################################################################################

################################################################################
# NETWORK CONFIGURATION
################################################################################
# Network interface/IP to bind service ports
# Use 0.0.0.0 to bind on all interfaces (required for Tailscale access)
# Use specific IP (e.g., 192.168.178.40) to bind only to LAN
HOST_BIND=0.0.0.0
# Local network subnet for VPN firewall
LAN_NETWORK=192.168.178.0/24
# Domain for services (can be local or public domain)
HOST_DOMAIN=local.domain
# Email for Let's Encrypt SSL certificates
ACME_EMAIL=admin@example.com

################################################################################
# FILE SHARING (Samba)
################################################################################
# Username for Samba access
SAMBA_USER=potato
# Password for Samba access (change this!)
SAMBA_PASSWORD=changeme

################################################################################
# Gitea
################################################################################
# Gitea SSH port (host side)
GITEA_SSH_PORT=2223

################################################################################
# SSH (OpenSSH Server)
################################################################################
# SSH username (non-root user created in container)
OPENSSH_USER=sshuser
# SSH password (required if PASSWORD_ACCESS is true)
OPENSSH_PASSWORD=change_this_ssh_password
# Enable password login (set to false when using keys only)
OPENSSH_PASSWORD_ACCESS=true
# Allow sudo for the SSH user (set to true if needed)
OPENSSH_SUDO_ACCESS=false
# SSH server port (host side)
OPENSSH_PORT=2222
# Optional public key sources (recommended over passwords)
OPENSSH_PUBLIC_KEY=
OPENSSH_PUBLIC_KEY_URL=
OPENSSH_PUBLIC_KEY_FILE=
OPENSSH_PUBLIC_KEY_DIR=
# Log SSH output to container stdout (useful for Docker logs)
OPENSSH_LOG_STDOUT=true

################################################################################
# CORE DATABASES
################################################################################
# PostgreSQL superuser password
POSTGRES_SUPER_PASSWORD=change_this_postgres_super_password
# Comma-separated list of databases to create
# NOTE: The init script creates these on postgres startup
POSTGRES_DATABASES=nextcloud,authentik,gitea,woodpecker,immich,calibre,linkding,n8n,healthchecks,stirlingpdf,atuin,homarr,paperless,openwebui,miniflux,grafana,infisical

# Database for Grafana (uses superuser access)
# Grafana will create its own tables on startup

# MongoDB
MONGO_ROOT_PASSWORD=change_this_mongo_root_password

# Redis (shared instance) - no password needed for internal use

################################################################################
# VPN CONFIGURATION (Gluetun + Tailscale + WireGuard)
################################################################################
# Gluetun VPN - For torrent/download clients
VPN_PROVIDER=surfshark
VPN_TYPE=wireguard
WIREGUARD_PRIVATE_KEY=your_wireguard_private_key
WIREGUARD_ADDRESSES=10.64.222.21/16
VPN_COUNTRY=Germany
VPN_LOG_LEVEL=info
VPN_INPUT_PORTS=51413,50000,6888
VPN_DNS=1.1.1.1

# Gluetun Monitor - VPN connection monitoring interval (in seconds)
# Checks VPN status and auto-restarts dependent containers on reconnect
GLUETUN_CHECK_INTERVAL=10
GLUETUN_RESTART_ON_STOP=true
GLUETUN_RESTART_ON_FAILURE=true
GLUETUN_RESTART_COOLDOWN=120

# Disk space monitor
DISK_MONITOR_PATHS=/mnt/storage /mnt/ssd /mnt/cachehdd
DISK_MONITOR_INTERVAL=300
DISK_MONITOR_WARN=80
DISK_MONITOR_CRIT=90

# Traefik log monitor
TRAEFIK_LOG_CHECK_INTERVAL=60
TRAEFIK_LOG_PATTERNS=acme|certificate|x509|tls
TRAEFIK_LOG_LEVEL_PATTERN=level=error
TRAEFIK_RESTART_ON_ERROR=false
TRAEFIK_RESTART_COOLDOWN=300

# Backup monitor
BACKUP_MONITOR_PATHS=/mnt/storage/kopia/stack-snapshot.log /mnt/storage/velld/backups
BACKUP_MAX_AGE_HOURS=48
BACKUP_MONITOR_INTERVAL=3600

# DB health monitor
DB_MONITOR_INTERVAL=30
DB_FAIL_THRESHOLD=3
DB_RESTART_COOLDOWN=180
DB_RESTART_ON_FAILURE=true
DB_CHECK_POSTGRES=true
DB_CHECK_REDIS=true
DB_CHECK_MONGO=false

# Tailscale connectivity monitor
TAILSCALE_PING_TARGET=
TAILSCALE_PING_INTERVAL=60
TAILSCALE_PING_FAIL_THRESHOLD=3
TAILSCALE_RESTART_COOLDOWN=300

# Tailscale - Mesh VPN for remote access (RECOMMENDED - easiest)
# Get key from: https://login.tailscale.com/admin/settings/keys
TAILSCALE_AUTHKEY=tskey-auth-your_tailscale_auth_key_here
# Tailscale HTTPS (tailscale serve) - wrap HTTP ports with TLS on your tailnet domain
# Comma-separated ports to expose as https://<tailscale-host>:PORT
TAILSCALE_SERVE_PORTS=7575,8088,3001,3002,8089,8096,5055,8989,7878,8686,9696,6767,8787,13378,8945,8282,6880,6800,2234,8097,8000,2283,8090,8080,8384,3004,3006,5678,9000,9091,8093,5006,9090,3100,9093,10903,10902,8094,8087,6060,8091,8001,8788,8888,8889,8081,3010,8085,8060,8288
TAILSCALE_SERVE_INTERVAL=300

################################################################################
# NOTIFICATIONS (ntfy)
################################################################################
NTFY_AUTH_DEFAULT_ACCESS=read-write
NTFY_ENABLE_LOGIN=false
NTFY_TOPIC=potatostack
NTFY_INTERNAL_URL=http://ntfy:80
NTFY_TOKEN=

################################################################################
# SECRETS MANAGEMENT (Infisical)
################################################################################
# 16-byte hex key (32 chars). Generate: openssl rand -hex 16
INFISICAL_ENCRYPTION_KEY=change_this_infisical_encryption_key
# Base64 secret. Generate: openssl rand -base64 32
INFISICAL_AUTH_SECRET=change_this_infisical_auth_secret

################################################################################
# IMMICH LOG MONITOR
################################################################################
IMMICH_LOG_CHECK_INTERVAL=60
IMMICH_RESTART_COOLDOWN=300
IMMICH_LOG_PATTERNS=redis|Redis|ECONNREFUSED|Connection refused|connect ECONNREFUSED|socket hang up

# WireGuard Server - For VPS gateway or advanced users
# SERVERURL: Your public IP or DynDNS (e.g., fritz.duckdns.org)
# Leave as 'auto' to auto-detect public IP
WIREGUARD_SERVERURL=auto
WIREGUARD_SERVERPORT=51820
# PEERS: Comma-separated list of peer names (each gets a config)
WIREGUARD_PEERS=vps,android,laptop,tablet,raspberry
WIREGUARD_PEERDNS=auto
WIREGUARD_INTERNAL_SUBNET=10.13.13.0/24
WIREGUARD_ALLOWEDIPS=0.0.0.0/0
WIREGUARD_LOG_CONFS=true

################################################################################
# REVERSE PROXY & SSL
################################################################################
# Traefik is main proxy on ports 80/443
# Nginx Proxy Manager is alternative on ports 8081/4443/81

################################################################################
# AUTHENTICATION & SECURITY
################################################################################
# Authentik SSO - Generate with: openssl rand -base64 32
# NOTE: Authentik 2025.10+ no longer requires Redis
AUTHENTIK_DB_PASSWORD=change_this_authentik_db_password
AUTHENTIK_SECRET_KEY=change_this_authentik_secret_key_64_chars_min

# CrowdSec IPS - Generate bouncer key with: cscli bouncers add traefik-bouncer
CROWDSEC_BOUNCER_KEY=change_this_crowdsec_bouncer_key

# Vaultwarden Password Manager - Generate with: openssl rand -base64 32
VAULTWARDEN_ADMIN_TOKEN=change_this_to_a_secure_random_token
VAULTWARDEN_SIGNUPS_ALLOWED=false
VAULTWARDEN_INVITATIONS_ALLOWED=true

# OAuth2-Proxy (OIDC / Authentik integration)
# NOTE: COOKIE_SECRET must be 16 or 32 bytes, base64-encoded
OAUTH2_PROXY_OIDC_ISSUER_URL=https://auth.local.domain/application/o/your-provider/
OAUTH2_PROXY_CLIENT_ID=change_this_oauth2_proxy_client_id
OAUTH2_PROXY_CLIENT_SECRET=change_this_oauth2_proxy_client_secret
OAUTH2_PROXY_COOKIE_SECRET=change_this_oauth2_proxy_cookie_secret
OAUTH2_PROXY_REDIRECT_URL=https://auth.local.domain/oauth2/callback
OAUTH2_PROXY_EMAIL_DOMAINS=*
OAUTH2_PROXY_COOKIE_DOMAINS=.local.domain
OAUTH2_PROXY_WHITELIST_DOMAINS=.local.domain

################################################################################
# DASHBOARD & MANAGEMENT
################################################################################
# Homarr - Generate with: openssl rand -hex 32
HOMARR_SECRET_KEY=change_this_homarr_secret_key_64_chars
HOMARR_LOG_LEVEL=info
HOMARR_DOCKER_HOSTNAMES=socket-proxy
HOMARR_DOCKER_PORTS=2375
SOCKET_PROXY_TAG=latest

################################################################################
# CLOUD STORAGE & FILE SYNC
################################################################################
# Nextcloud All-in-One (SOTA 2025)
# Includes Collabora Office, Talk, Whiteboard, and more
# No separate database needed - managed by AIO
# Access AIO interface at http://HOST_BIND:8080
# Nextcloud at http://HOST_BIND:8443

################################################################################
# KNOWLEDGE MANAGEMENT
################################################################################
# CouchDB - For Obsidian LiveSync (SOTA 2025)
COUCHDB_USER=obsidian
COUCHDB_PASSWORD=change_this_couchdb_password
COUCHDB_DATABASE=obsidian-vault
# After setup, configure Obsidian plugin:
# Server: https://obsidian.HOST_DOMAIN (via Traefik)
# Database: obsidian-vault
# Username: obsidian
# Password: [COUCHDB_PASSWORD]

################################################################################
# FINANCE
################################################################################
# Firefly III - Generate APP_KEY with: php artisan key:generate
FIREFLY_DB_PASSWORD=change_this_firefly_db_password
FIREFLY_APP_KEY=base64:your_firefly_app_key_here
FIREFLY_ACCESS_TOKEN=get_from_firefly_after_setup

# Optional: GoCardless / Nordigen for bank sync
NORDIGEN_ID=
NORDIGEN_KEY=

# Optional: Spectre for bank sync
SPECTRE_APP_ID=
SPECTRE_SECRET=

################################################################################
# MEDIA - ARR STACK
################################################################################
# All *arr apps use the same structure, no passwords needed for internal use

################################################################################
# DOWNLOAD CLIENTS (behind VPN)
################################################################################
# qBittorrent Torrent Client
# Automatically downloads to /mnt/cachehdd/qbittorrent-incomplete
# and moves completed files to /mnt/storage/downloads
QBITTORRENT_USER=admin
QBITTORRENT_PASSWORD=change_this_qbittorrent_password

################################################################################
# Aria2 Download Manager
# Advanced download manager with BT/HTTP/FTP/Metalink support
# Downloads to /mnt/storage/aria2-downloads
# Incomplete files cached at /mnt/cachehdd/aria2-incomplete
# WebUI: http://HOST_BIND:6880 (AriaNg)
# Configure RPC secret in AriaNg settings
ARIA2_RPC_SECRET=change_this_aria2_rpc_secret

# slskd - Soulseek P2P client
# Web UI credentials
SLSKD_USER=admin
SLSKD_PASSWORD=change_this_slskd_password
# Soulseek network credentials (your actual Soulseek account)
SLSKD_SOULSEEK_USERNAME=your_soulseek_username
SLSKD_SOULSEEK_PASSWORD=your_soulseek_password
# Get API key from slskd WebUI: Settings > Application > API Key
# Leave empty on first run, then get from UI after setup
SLSKD_API_KEY=

################################################################################
# MONITORING & OBSERVABILITY
################################################################################
# Grafana
GRAFANA_USER=admin
GRAFANA_PASSWORD=change_this_grafana_password
GRAFANA_PLUGINS=

# Prometheus retention
PROMETHEUS_RETENTION_DAYS=30d

# Parseable - Log analytics (Loki alternative)
PARSEABLE_USERNAME=admin
PARSEABLE_PASSWORD=change_this_parseable_password
PARSEABLE_ADDR=0.0.0.0:8000
PARSEABLE_FS_DIR=/data

# Scrutiny - HDD SMART monitoring
# Add more devices in docker-compose.yml if needed
SCRUTINY_DEVICE_1=/dev/sda

# Fritzbox Exporter (optional)
FRITZ_USERNAME=
FRITZ_PASSWORD=your_fritzbox_admin_password
FRITZ_HOSTNAME=fritz.box

################################################################################
# AUTOMATION & WORKFLOWS
################################################################################
# n8n
N8N_USER=admin
N8N_PASSWORD=change_this_n8n_password

# Huginn - Generate with: openssl rand -hex 32
HUGINN_SECRET_TOKEN=change_this_huginn_secret_token
HUGINN_INVITATION_CODE=change_this_invitation_code

# Healthchecks
HEALTHCHECKS_ADMIN_EMAIL=admin@example.com
HEALTHCHECKS_ADMIN_PASSWORD=change_this_healthchecks_password
HEALTHCHECKS_SECRET_KEY=change_this_healthchecks_secret_key

################################################################################
# DOCUMENT MANAGEMENT
################################################################################
# Paperless-ngx - Generate with: openssl rand -base64 32
PAPERLESS_SECRET_KEY=change_this_paperless_secret_key
PAPERLESS_ADMIN_PASSWORD=change_this_paperless_admin_password

################################################################################
# UTILITIES & TOOLS
################################################################################
# Linkding
LINKDING_ADMIN_USER=admin
LINKDING_ADMIN_PASSWORD=change_this_linkding_password

# Cal.com - Generate with: openssl rand -base64 32
CALCOM_NEXTAUTH_SECRET=change_this_calcom_nextauth_secret
CALCOM_ENCRYPTION_KEY=change_this_calcom_encryption_key

# Atuin - Shell history sync (uses shared postgres)
ATUIN_HOST=0.0.0.0
ATUIN_PORT=8888

# Filebrowser - Web-based file manager
FILEBROWSER_USER=admin
FILEBROWSER_PASSWORD=change_this_filebrowser_password

# Code Server
CODE_SERVER_PASSWORD=change_this_code_server_password
CODE_SERVER_SUDO_PASSWORD=change_this_code_server_sudo_password

################################################################################
# DEVELOPMENT & GIT
################################################################################
# Gitea
GITEA_TAG=latest
GITEA_RUNNER_TOKEN=get_from_gitea_after_setup

# Woodpecker CI (Gitea integration)
WOODPECKER_GITEA_CLIENT=get_from_gitea_oauth_app
WOODPECKER_GITEA_SECRET=get_from_gitea_oauth_app
WOODPECKER_AGENT_SECRET=change_this_woodpecker_agent_secret
WOODPECKER_ADMIN=your_gitea_username
WOODPECKER_MAX_WORKFLOWS=2

# Calibre-web - Ebook management (optional, uses shared postgres)
# Access: http://HOST_BIND:8083
# Note: Calibre-web uses SQLite by default, configure for PostgreSQL if needed
CALIBRE_DB_PASSWORD=change_this_calibre_db_password

# Drone CI
DRONE_GITEA_CLIENT_ID=get_from_gitea_oauth_app
DRONE_GITEA_CLIENT_SECRET=get_from_gitea_oauth_app
DRONE_RPC_SECRET=change_this_drone_rpc_secret
DRONE_ADMIN_USER=your_gitea_username

# Sentry
SENTRY_DB_PASSWORD=change_this_sentry_db_password
SENTRY_SECRET_KEY=change_this_sentry_secret_key

################################################################################
# AI & SPECIAL APPLICATIONS
################################################################################
# Open WebUI - For local LLM interaction
OLLAMA_BASE_URL=http://host.docker.internal:11434
OPEN_WEBUI_SECRET_KEY=change_this_open_webui_secret_key

# OctoBot - Crypto trading bot (configure in web UI after first start)

################################################################################
# ELASTICSEARCH STACK
################################################################################
ELASTIC_PASSWORD=change_this_elastic_password

################################################################################
# BACKUPS
################################################################################
# Kopia - Fast and secure backups
KOPIA_PASSWORD=change_this_kopia_password
KOPIA_SERVER_USER=admin
KOPIA_SERVER_PASSWORD=change_this_kopia_server_password

# Kopia snapshot scheduler (cron)
SNAPSHOT_CRON_SCHEDULE=0 3 * * *
SNAPSHOT_PATHS=/data
SNAPSHOT_LOG_FILE=/mnt/storage/kopia/stack-snapshot.log

# Velld - Database backup scheduler
# NOTE: ENCRYPTION_KEY must be a 64-character hex string (openssl rand -hex 32)
VELLD_API_URL=http://192.168.178.40:8085
VELLD_JWT_SECRET=change_this_velld_jwt_secret
VELLD_ENCRYPTION_KEY=change_this_velld_encryption_key
VELLD_ADMIN_USERNAME=admin
VELLD_ADMIN_PASSWORD=change_this_velld_admin_password
VELLD_ALLOW_REGISTER=false

################################################################################
# FILE SYNC & SHARING
################################################################################
# Syncthing - P2P file synchronization
# Hostname for Syncthing instance (visible to other devices)
SYNCTHING_HOSTNAME=potatostack-sync
# Get API key from Syncthing WebUI: Settings > General > API Key
# Leave empty on first run, then get from UI after setup
SYNCTHING_API_KEY=

# Portainer - Container management
# Get API key from Portainer: User Settings > Access tokens
# Leave empty on first run, then get from UI after setup
PORTAINER_API_KEY=

################################################################################
# ATUIN (Shell history sync)
################################################################################
# Allow open registration (set false for invite-only)
ATUIN_OPEN_REGISTRATION=false

################################################################################
# SYSTEM UTILITIES
################################################################################
# Diun - Docker Image Update Notifier (SOTA 2025 best practice)
# Monitors for updates but doesn't auto-update (safer than Watchtower)
# Notification options (optional - choose one or more):

# Gotify
DIUN_GOTIFY_ENDPOINT=
DIUN_GOTIFY_TOKEN=

# Discord
DIUN_DISCORD_WEBHOOK=

# Telegram
DIUN_TELEGRAM_TOKEN=
DIUN_TELEGRAM_CHATIDS=

################################################################################
# IMAGE TAGS
# Databases pinned for data compatibility, apps set to latest
################################################################################
# Core (databases pinned)
ALPINE_TAG=latest
POSTGRES_TAG=16-alpine
MONGO_TAG=8
REDIS_TAG=alpine
ADMINER_TAG=latest

# Reverse Proxy
TRAEFIK_TAG=latest
NPM_TAG=latest

# Authentication
AUTHENTIK_TAG=latest
VAULTWARDEN_TAG=latest
OAUTH2_PROXY_TAG=latest

# VPN
GLUETUN_TAG=latest
TAILSCALE_TAG=latest

# Cloud Storage
NEXTCLOUD_AIO_TAG=latest
SYNCTHING_TAG=latest

# Knowledge Management
COUCHDB_TAG=latest
OBSIDIAN_LIVESYNC_TAG=latest
CURL_TAG=latest

# Finance
FIREFLY_TAG=latest
FIREFLY_IMPORTER_TAG=latest

# Media Management
PROWLARR_TAG=latest
SONARR_TAG=latest
RADARR_TAG=latest
LIDARR_TAG=latest
READARR_TAG=develop
BAZARR_TAG=latest
MAINTAINERR_TAG=latest
JELLYFIN_TAG=latest
JELLYSEERR_TAG=latest
OVERSEERR_TAG=latest
AUDIOBOOKSHELF_TAG=latest

# Downloads
QBITTORRENT_TAG=latest
ARIA2_TAG=latest
ARIANG_TAG=latest

# Photos
IMMICH_TAG=release

# Monitoring
PROMETHEUS_TAG=latest
GRAFANA_TAG=latest
LOKI_TAG=latest
PROMTAIL_TAG=latest
ALLOY_TAG=latest
NODE_EXPORTER_TAG=latest
CADVISOR_TAG=latest
FRITZBOX_EXPORTER_TAG=latest
NETDATA_TAG=latest
UPTIME_KUMA_TAG=latest
PARSEABLE_TAG=latest
SCRUTINY_TAG=latest

# Automation
N8N_TAG=latest
HUGINN_TAG=latest
HEALTHCHECKS_TAG=latest

# Utilities
SAMBA_TAG=latest
OPENSSH_SERVER_TAG=latest
NTFY_TAG=latest
RUSTYPASTE_TAG=latest
STIRLING_PDF_TAG=latest
LINKDING_TAG=latest
CALCOM_TAG=latest
CODE_SERVER_TAG=latest
DRAWIO_TAG=latest
EXCALIDRAW_TAG=latest
ATUIN_TAG=latest
DUCKDB_TAG=latest

# Development
GITEA_TAG=latest
GITEA_RUNNER_TAG=latest
WOODPECKER_TAG=latest
WOODPECKER_AGENT_TAG=latest
DRONE_TAG=latest
DRONE_RUNNER_TAG=latest
SENTRY_TAG=latest

# AI & Special
OPEN_WEBUI_TAG=latest
OCTOBOT_TAG=latest
PINCHFLAT_TAG=latest

# Elasticsearch (must match versions)
ELASTICSEARCH_TAG=8
KIBANA_TAG=8
LOGSTASH_TAG=8

# Dashboard
GLANCE_TAG=latest

# System
DIUN_TAG=latest
AUTOHEAL_TAG=latest
PORTAINER_TAG=latest
DOCKER_CLI_TAG=latest

# Secrets
INFISICAL_TAG=latest

# VPN Tags
WIREGUARD_TAG=latest

# Downloads & P2P
SLSKD_TAG=latest

# Backups
KOPIA_TAG=latest
VELLD_API_TAG=latest
VELLD_WEB_TAG=latest

################################################################################
# Notes:
# - Copy this file to .env and fill in real values
# - Generate strong passwords/secrets for all services
# - Update HOST_BIND to your server's IP
# - Configure VPN credentials for services behind Gluetun
# - Set up Tailscale for secure remote access
# - Configure domain and SSL for production use
#
# Quick generation commands:
# - Password: openssl rand -base64 32
# - Secret key: openssl rand -hex 64
# - API key: openssl rand -hex 32
#
# Service URLs (after setup):
# - Traefik Dashboard: http://traefik.HOST_DOMAIN:8080
# - Grafana: http://grafana.HOST_DOMAIN
# - Prometheus: http://HOST_BIND:9090
# - Jellyfin: http://jellyfin.HOST_DOMAIN
# - Immich: http://immich.HOST_DOMAIN
# - Nextcloud AIO: http://HOST_BIND:8443
# - Gitea: http://git.HOST_DOMAIN
# - n8n: http://n8n.HOST_DOMAIN:5678
# - Cal.com: http://cal.HOST_DOMAIN
# - Authentik: http://authentik.HOST_DOMAIN:9000
################################################################################

# RSS & News Aggregation
MINIFLUX_TAG=latest
MINIFLUX_ADMIN_USER=admin
MINIFLUX_ADMIN_PASSWORD=changeme

# Monitoring & Observability (tags defined above in IMAGE TAGS section)
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=changeme
NETDATA_CLAIM_TOKEN=
NETDATA_CLAIM_ROOMS=
# Thanos Long-term Storage
THANOS_TAG=latest
