# Miniflux - Minimalist RSS Feed Reader
# Chart: oci://ghcr.io/bjw-s-labs/charts/app-template
# RAM: ~30MB | Lightweight Go app
# Installation: helm install miniflux oci://ghcr.io/bjw-s-labs/charts/app-template -f helm/values/miniflux.yaml -n potatostack

controllers:
  main:
    replicas: 1
    containers:
      main:
        image:
          repository: miniflux/miniflux
          tag: 2.2.4
        env:
          TZ: Europe/Berlin
          DATABASE_URL: postgres://miniflux:${MINIFLUX_DB_PASSWORD}@postgres.potatostack.svc.cluster.local/miniflux?sslmode=disable
          RUN_MIGRATIONS: "1"
          CREATE_ADMIN: "1"
          ADMIN_USERNAME: admin
          ADMIN_PASSWORD: ${MINIFLUX_ADMIN_PASSWORD}
          BASE_URL: https://rss.lepotato.local
          POLLING_FREQUENCY: "60"  # Poll feeds every 60 minutes
          BATCH_SIZE: "10"
        resources:
          requests:
            memory: 24Mi
            cpu: 50m
          limits:
            memory: 64Mi
            cpu: 200m

service:
  main:
    ports:
      http:
        port: 8080

ingress:
  main:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: rss.lepotato.local
        paths:
          - path: /
            service:
              name: main
              port: http
    tls:
      - secretName: miniflux-tls
        hosts:
          - rss.lepotato.local

# Note: Create database first:
# kubectl exec -it statefulset/postgres -n potatostack -- psql -U postgres
# CREATE DATABASE miniflux;
# CREATE USER miniflux WITH PASSWORD 'your_password';
# GRANT ALL PRIVILEGES ON DATABASE miniflux TO miniflux;
