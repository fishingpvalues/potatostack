apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: paperless-ngx
  namespace: argocd
spec:
  project: default
  source:
    repoURL: oci://ghcr.io/gabe565/charts
    chart: paperless-ngx
    targetRevision: 2.9.2
    helm:
      values: |
        # This configuration assumes you have an existing PostgreSQL and Redis
        # instance running in your cluster.

        # Disable the included postgresql and redis
        postgresql:
          enabled: false
        redis:
          enabled: false

        # Configure paperless-ngx to use your existing services
        paperless:
          env:
            # Point to your existing redis service
            PAPERLESS_REDIS: "redis://redis:6379/1"

            # Point to your existing postgres service
            PAPERLESS_DBENGINE: postgresql
            PAPERLESS_DBHOST: postgres
            PAPERLESS_DBPORT: "5432"
            PAPERLESS_DBNAME: paperless
            PAPERLESS_DBUSER: paperless
            PAPERLESS_DBPASS_SECRET:
              name: paperless-secrets
              key: PAPERLESS_DB_PASSWORD

        ingress:
          enabled: true
          ingressClassName: nginx
          hosts:
            - host: paperless.lepotato.local
              paths:
                - path: /
                  pathType: Prefix
          tls:
           - secretName: paperless-tls
             hosts:
               - paperless.lepotato.local

        persistence:
          consume:
            enabled: true
            storageClass: longhorn
            accessMode: ReadWriteOnce
            size: 1Gi
          data:
            enabled: true
            storageClass: longhorn
            accessMode: ReadWriteOnce
            size: 5Gi
          media:
            enabled: true
            storageClass: longhorn
            accessMode: ReadWriteOnce
            size: 50Gi

        # Set a default admin user and password
        # IMPORTANT: Change these default credentials
        secrets:
          PAPERLESS_ADMIN_USER:
            value: admin
          PAPERLESS_ADMIN_PASSWORD:
            value: admin
  destination:
    server: https://kubernetes.default.svc
    namespace: documents
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
